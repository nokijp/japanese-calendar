<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">JapaneseCalendar</span><span class="hs-operator">.</span><span class="hs-identifier">SolarTerm</span><span>
</span><a name="line-4"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#SolarTerm"><span class="hs-identifier hs-type">SolarTerm</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-5"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#isSegmentPoint"><span class="hs-identifier hs-var">isSegmentPoint</span></a><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#isCenterPoint"><span class="hs-identifier hs-var">isCenterPoint</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#solarTerm"><span class="hs-identifier hs-var">solarTerm</span></a><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#nearestSolarTerm"><span class="hs-identifier hs-var">nearestSolarTerm</span></a><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#solarTermsFrom"><span class="hs-identifier hs-var">solarTermsFrom</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Time.JapaneseCalendar.SolarTerm.html#findNearestSolarTerm"><span class="hs-identifier hs-var">findNearestSolarTerm</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">Calendar</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Time.JapaneseCalendar.Internal.Sun.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">JapaneseCalendar</span><span class="hs-operator">.</span><span class="hs-identifier">Internal</span><span class="hs-operator">.</span><span class="hs-identifier">Sun</span></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><a href="Data.Time.JapaneseCalendar.JapaneseName.html"><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">JapaneseCalendar</span><span class="hs-operator">.</span><span class="hs-identifier">JapaneseName</span></a><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data</span><span class="hs-operator">.</span><span class="hs-identifier">Time</span><span class="hs-operator">.</span><span class="hs-identifier">LocalTime</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-comment">-- | the twenty-four solar terms</span><span>
</span><a name="line-19"></a><span class="hs-keyword">data</span><span> </span><a name="SolarTerm"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#SolarTerm"><span class="hs-identifier">SolarTerm</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-20"></a><span>    </span><a name="VernalEquinox"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#VernalEquinox"><span class="hs-identifier">VernalEquinox</span></a></a><span>  </span><span class="hs-comment">-- ^ &#26149;&#20998;</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ClearAndBright"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#ClearAndBright"><span class="hs-identifier">ClearAndBright</span></a></a><span>  </span><span class="hs-comment">-- ^ &#28165;&#26126;</span><span>
</span><a name="line-22"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GrainRain"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#GrainRain"><span class="hs-identifier">GrainRain</span></a></a><span>  </span><span class="hs-comment">-- ^ &#31296;&#38632;</span><span>
</span><a name="line-23"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StartOfSummer"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#StartOfSummer"><span class="hs-identifier">StartOfSummer</span></a></a><span>  </span><span class="hs-comment">-- ^ &#31435;&#22799;</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GrainFull"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#GrainFull"><span class="hs-identifier">GrainFull</span></a></a><span>  </span><span class="hs-comment">-- ^ &#23567;&#28288;</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="GrainInEar"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#GrainInEar"><span class="hs-identifier">GrainInEar</span></a></a><span>  </span><span class="hs-comment">-- ^ &#33426;&#31278;</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="SummerSolstice"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#SummerSolstice"><span class="hs-identifier">SummerSolstice</span></a></a><span>  </span><span class="hs-comment">-- ^ &#22799;&#33267;</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MinorHeat"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#MinorHeat"><span class="hs-identifier">MinorHeat</span></a></a><span>  </span><span class="hs-comment">-- ^ &#23567;&#26257;</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MajorHeat"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#MajorHeat"><span class="hs-identifier">MajorHeat</span></a></a><span>  </span><span class="hs-comment">-- ^ &#22823;&#26257;</span><span>
</span><a name="line-29"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StartOfAutumn"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#StartOfAutumn"><span class="hs-identifier">StartOfAutumn</span></a></a><span>  </span><span class="hs-comment">-- ^ &#31435;&#31179;</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="LimitOfHeat"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#LimitOfHeat"><span class="hs-identifier">LimitOfHeat</span></a></a><span>  </span><span class="hs-comment">-- ^ &#20966;&#26257;</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="WhiteDew"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#WhiteDew"><span class="hs-identifier">WhiteDew</span></a></a><span>  </span><span class="hs-comment">-- ^ &#30333;&#38706;</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AutumnalEquinox"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#AutumnalEquinox"><span class="hs-identifier">AutumnalEquinox</span></a></a><span>  </span><span class="hs-comment">-- ^ &#31179;&#20998;</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="ColdDew"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#ColdDew"><span class="hs-identifier">ColdDew</span></a></a><span>  </span><span class="hs-comment">-- ^ &#23506;&#38706;</span><span>
</span><a name="line-34"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="FrostDescent"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#FrostDescent"><span class="hs-identifier">FrostDescent</span></a></a><span>  </span><span class="hs-comment">-- ^ &#38684;&#38477;</span><span>
</span><a name="line-35"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StartOfWinter"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#StartOfWinter"><span class="hs-identifier">StartOfWinter</span></a></a><span>  </span><span class="hs-comment">-- ^ &#31435;&#20908;</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MinorSnow"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#MinorSnow"><span class="hs-identifier">MinorSnow</span></a></a><span>  </span><span class="hs-comment">-- ^ &#23567;&#38634;</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MajorSnow"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#MajorSnow"><span class="hs-identifier">MajorSnow</span></a></a><span>  </span><span class="hs-comment">-- ^ &#22823;&#38634;</span><span>
</span><a name="line-38"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="WinterSolstice"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#WinterSolstice"><span class="hs-identifier">WinterSolstice</span></a></a><span>  </span><span class="hs-comment">-- ^ &#20908;&#33267;</span><span>
</span><a name="line-39"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MinorCold"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#MinorCold"><span class="hs-identifier">MinorCold</span></a></a><span>  </span><span class="hs-comment">-- ^ &#23567;&#23506;</span><span>
</span><a name="line-40"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="MajorCold"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#MajorCold"><span class="hs-identifier">MajorCold</span></a></a><span>  </span><span class="hs-comment">-- ^ &#22823;&#23506;</span><span>
</span><a name="line-41"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="StartOfSpring"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#StartOfSpring"><span class="hs-identifier">StartOfSpring</span></a></a><span>  </span><span class="hs-comment">-- ^ &#31435;&#26149;</span><span>
</span><a name="line-42"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="RainWater"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#RainWater"><span class="hs-identifier">RainWater</span></a></a><span>  </span><span class="hs-comment">-- ^ &#38632;&#27700;</span><span>
</span><a name="line-43"></a><span>  </span><span class="hs-glyph">|</span><span> </span><a name="AwakeningOfInsects"><a href="Data.Time.JapaneseCalendar.SolarTerm.html#AwakeningOfInsects"><span class="hs-identifier">AwakeningOfInsects</span></a></a><span>  </span><span class="hs-comment">-- ^ &#21843;&#34756;</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-identifier hs-var">derivingJapaneseNameBoundedEnum</span><span> </span><span class="hs-char">''SolarTerm
  [ &quot;&#26149;&#20998;&quot;
  , &quot;&#28165;&#26126;&quot;
  , &quot;&#31296;&#38632;&quot;
  , &quot;&#31435;&#22799;&quot;
  , &quot;&#23567;&#28288;&quot;
  , &quot;&#33426;&#31278;&quot;
  , &quot;&#22799;&#33267;&quot;
  , &quot;&#23567;&#26257;&quot;
  , &quot;&#22823;&#26257;&quot;
  , &quot;&#31435;&#31179;&quot;
  , &quot;&#20966;&#26257;&quot;
  , &quot;&#30333;&#38706;&quot;
  , &quot;&#31179;&#20998;&quot;
  , &quot;&#23506;&#38706;&quot;
  , &quot;&#38684;&#38477;&quot;
  , &quot;&#31435;&#20908;&quot;
  , &quot;&#23567;&#38634;&quot;
  , &quot;&#22823;&#38634;&quot;
  , &quot;&#20908;&#33267;&quot;
  , &quot;&#23567;&#23506;&quot;
  , &quot;&#22823;&#23506;&quot;
  , &quot;&#31435;&#26149;&quot;
  , &quot;&#38632;&#27700;&quot;
  , &quot;&#21843;&#34756;&quot;
  ]

-- | tests whether a solar term is a segment point, sekki
isSegmentPoint :: SolarTerm -&gt; Bool
isSegmentPoint term = fromEnum term `mod` 2 == 1

-- | tests whether a solar term is a center point, chuki
isCenterPoint :: SolarTerm -&gt; Bool
isCenterPoint = not . isSegmentPoint

-- | returns a solar term of a specified day
solarTerm :: TimeZone -&gt; Day -&gt; Maybe SolarTerm
solarTerm zone day = if day == divisionDay then Just term else Nothing
  where
    (term, divisionDay) = nearestSolarTerm zone day

-- | finds the nearest solar term
nearestSolarTerm :: TimeZone -&gt; Day -&gt; (SolarTerm, Day)
nearestSolarTerm zone day = fromIndex zone index day
  where
    utcTime = localTimeToUTC zone (LocalTime day midday)
    index = round (sunEclipticLongitude utcTime / 15) `mod` 24

-- | creates a list of solar terms starting with the nearest solar term from a specified day
solarTermsFrom :: TimeZone -&gt; Day -&gt; [(SolarTerm, Day)]
solarTermsFrom zone day = firstElem : solarTermsFrom zone nextSeed
  where
    firstElem@(_, firstElemDay) = nearestSolarTerm zone day
    nextSeed = addDays 15 firstElemDay

-- | finds the nearest specified solar term
findNearestSolarTerm :: TimeZone -&gt; SolarTerm -&gt; Day -&gt; Day
findNearestSolarTerm zone term day = snd $ fromIndex zone (fromEnum term) day

fromIndex :: TimeZone -&gt; Int -&gt; Day -&gt; (SolarTerm, Day)
fromIndex zone index day = (toEnum index, divisionDay)
  where
    utcTime = localTimeToUTC zone (LocalTime day midday)
    divisionUTCTime = sunEclipticLongitudeToTime (fromIntegral $ index * 15) utcTime
    divisionTime = utcToZonedTime zone divisionUTCTime
    divisionDay = localDay $ zonedTimeToLocalTime divisionTime
</span></pre></body></html>